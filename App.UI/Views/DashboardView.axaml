<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:App.UI.ViewModels"
             x:Class="App.UI.Views.DashboardView"
             x:DataType="vm:DashboardViewModel">

    <TabControl SelectedIndex="{Binding SelectedTabIndex}">
        <TabItem Header="Projects">
            <Grid RowDefinitions="Auto,*" ColumnDefinitions="2*,3*" Margin="10">
                <!-- Projects Master -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,5,5">
                    <TextBlock Text="Projects" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                    <Button Content="Load Projects" Command="{Binding ProjectMasterViewModel.LoadProjectsCommand}" Margin="0,0,0,5"/>
                    <Button Content="Export to CSV" Command="{Binding ProjectMasterViewModel.ExportToCsvCommand}" Margin="0,0,0,5"/>
                </StackPanel>

                <ListBox Grid.Row="1" Grid.Column="0"
                         ItemsSource="{Binding ProjectMasterViewModel.Projects}"
                         SelectedItem="{Binding ProjectMasterViewModel.SelectedProject}"
                         Margin="0,0,5,0">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                <TextBlock Text="{Binding Key}" FontSize="11" Foreground="Gray"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Project Detail -->
                <ScrollViewer Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" Margin="5,0,0,0">
                    <StackPanel DataContext="{Binding ProjectMasterViewModel.ProjectDetailViewModel}">
                        <TextBlock Text="Project Details" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

                        <TextBlock Text="Name:"/>
                        <TextBox Text="{Binding Name}" IsReadOnly="{Binding !IsEditMode}" Margin="0,0,0,10"/>

                        <TextBlock Text="Key:"/>
                        <TextBox Text="{Binding Key}" IsReadOnly="{Binding !IsEditMode}" Margin="0,0,0,10"/>

                        <TextBlock Text="Description:"/>
                        <TextBox Text="{Binding Description}" IsReadOnly="{Binding !IsEditMode}"
                                 AcceptsReturn="True" Height="100" Margin="0,0,0,10"/>

                        <CheckBox Content="Active" IsChecked="{Binding IsActive}" IsEnabled="{Binding IsEditMode}" Margin="0,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <Button Content="Edit" Command="{Binding StartEditCommand}" IsVisible="{Binding !IsEditMode}"/>
                            <Button Content="Save" Command="{Binding SaveCommand}" IsVisible="{Binding IsEditMode}"/>
                            <Button Content="Cancel" Command="{Binding CancelEditCommand}" IsVisible="{Binding IsEditMode}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </TabItem>

        <TabItem Header="Tasks">
            <Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="2*,3*" Margin="10">
                <!-- Tasks Filter/Search -->
                <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,10">
                    <TextBlock Text="Tasks" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

                    <Grid ColumnDefinitions="*,*,*,Auto,Auto">
                        <TextBox Grid.Column="0" Watermark="Search..."
                                 Text="{Binding TaskMasterViewModel.SearchText}" Margin="0,0,5,0"/>
                        <ComboBox Grid.Column="1" PlaceholderText="Status"
                                  ItemsSource="{Binding TaskMasterViewModel.AvailableStatuses}"
                                  SelectedItem="{Binding TaskMasterViewModel.SelectedStatus}" Margin="0,0,5,0"/>
                        <ComboBox Grid.Column="2" PlaceholderText="Priority"
                                  ItemsSource="{Binding TaskMasterViewModel.AvailablePriorities}"
                                  SelectedItem="{Binding TaskMasterViewModel.SelectedPriority}" Margin="0,0,5,0"/>
                        <Button Grid.Column="3" Content="Search" Command="{Binding TaskMasterViewModel.SearchCommand}" Margin="0,0,5,0"/>
                        <Button Grid.Column="4" Content="Clear" Command="{Binding TaskMasterViewModel.ClearFiltersCommand}"/>
                    </Grid>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,5,5" Orientation="Horizontal" Spacing="5">
                    <Button Content="Load Tasks" Command="{Binding TaskMasterViewModel.LoadTasksCommand}"/>
                    <Button Content="Export to CSV" Command="{Binding TaskMasterViewModel.ExportToCsvCommand}"/>
                </StackPanel>

                <!-- Tasks Master -->
                <ListBox Grid.Row="2" Grid.Column="0"
                         ItemsSource="{Binding TaskMasterViewModel.Tasks}"
                         SelectedItem="{Binding TaskMasterViewModel.SelectedTask}"
                         Margin="0,0,5,0">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding Title}" FontWeight="Bold"/>
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <TextBlock Text="{Binding Status}" FontSize="11" Foreground="Blue"/>
                                    <TextBlock Text="{Binding Priority}" FontSize="11" Foreground="Red"/>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Task Detail -->
                <ScrollViewer Grid.Row="1" Grid.RowSpan="2" Grid.Column="1" Margin="5,0,0,0">
                    <StackPanel DataContext="{Binding TaskMasterViewModel.TaskDetailViewModel}">
                        <TextBlock Text="Task Details" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

                        <TextBlock Text="{Binding TaskType, StringFormat='Type: {0}'}" FontWeight="Bold" Margin="0,0,0,10"/>

                        <TextBlock Text="Title:"/>
                        <TextBox Text="{Binding Title}" IsReadOnly="{Binding !IsEditMode}" Margin="0,0,0,10"/>

                        <TextBlock Text="Description:"/>
                        <TextBox Text="{Binding Description}" IsReadOnly="{Binding !IsEditMode}"
                                 AcceptsReturn="True" Height="100" Margin="0,0,0,10"/>

                        <TextBlock Text="Status:"/>
                        <TextBlock Text="{Binding Status}" Margin="0,0,0,10"/>

                        <TextBlock Text="Priority:"/>
                        <TextBlock Text="{Binding Priority}" Margin="0,0,0,10"/>

                        <TextBlock Text="Project:"/>
                        <TextBlock Text="{Binding ProjectName}" Margin="0,0,0,10"/>

                        <TextBlock Text="Assigned To:"/>
                        <TextBlock Text="{Binding AssignedToName}" Margin="0,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <Button Content="Edit" Command="{Binding StartEditCommand}" IsVisible="{Binding !IsEditMode}"/>
                            <Button Content="Save" Command="{Binding SaveCommand}" IsVisible="{Binding IsEditMode}"/>
                            <Button Content="Cancel" Command="{Binding CancelEditCommand}" IsVisible="{Binding IsEditMode}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </TabItem>
    </TabControl>
</UserControl>
