<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:App.UI.ViewModels"
             x:Class="App.UI.Views.DashboardView"
             x:DataType="vm:DashboardViewModel"
             Background="{StaticResource PrimaryBgBrush}">

    <TabControl SelectedIndex="{Binding SelectedTabIndex}" Background="{StaticResource PrimaryBgBrush}">
        <TabItem Header="Projects">
            <Grid RowDefinitions="Auto,*" ColumnDefinitions="2*,3*" Margin="10" Background="{StaticResource PrimaryBgBrush}">
                <!-- Projects Master Sidebar -->
                <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                        Background="{StaticResource SecondaryBgBrush}"
                        CornerRadius="6"
                        Padding="20"
                        Margin="0,0,10,0">
                    <Grid RowDefinitions="Auto,Auto,*">
                        <TextBlock Grid.Row="0" Text="Projects" FontSize="18" FontWeight="Bold"
                                   Foreground="{StaticResource HeadingTextBrush}" Margin="0,0,0,15"/>

                        <StackPanel Grid.Row="1" Spacing="8" Margin="0,0,0,15">
                            <Button Content="Load Projects" Command="{Binding ProjectMasterViewModel.LoadProjectsCommand}"/>
                            <Button Content="Export to CSV" Command="{Binding ProjectMasterViewModel.ExportToCsvCommand}"/>
                        </StackPanel>

                        <ListBox Grid.Row="2"
                                 ItemsSource="{Binding ProjectMasterViewModel.Projects}"
                                 SelectedItem="{Binding ProjectMasterViewModel.SelectedProject}"
                                 Background="{StaticResource SecondaryBgBrush}"
                                 BorderThickness="0">
                            <ListBox.Styles>
                                <Style Selector="ListBoxItem">
                                    <Setter Property="Background" Value="{StaticResource CardBgBrush}"/>
                                    <Setter Property="Margin" Value="0,0,0,8"/>
                                    <Setter Property="Padding" Value="12"/>
                                    <Setter Property="CornerRadius" Value="4"/>
                                    <Setter Property="BorderBrush" Value="{StaticResource BorderDefaultBrush}"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Style>
                                <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="{StaticResource PrimaryButtonBgBrush}"/>
                                </Style>
                                <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                                    <Setter Property="Background" Value="{StaticResource PrimaryButtonBgBrush}"/>
                                </Style>
                            </ListBox.Styles>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="{StaticResource InputTextBrush}"/>
                                        <TextBlock Text="{Binding Key}" FontSize="11" Foreground="{StaticResource LabelTextBrush}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <!-- Project Detail Panel -->
                <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                        Background="{StaticResource CardBgBrush}"
                        CornerRadius="6"
                        Padding="20"
                        BorderBrush="{StaticResource BorderDefaultBrush}"
                        BorderThickness="1">
                    <ScrollViewer>
                        <StackPanel DataContext="{Binding ProjectMasterViewModel.ProjectDetailViewModel}">
                            <TextBlock Text="Project Details" FontSize="18" FontWeight="Bold"
                                       Foreground="{StaticResource HeadingTextBrush}" Margin="0,0,0,15"/>

                            <TextBlock Text="Name:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Name}" 
                                     IsReadOnly="{Binding !IsEditMode}" 
                                     Watermark="Press &quot;Load projects&quot; button &amp; choose your project"
                                     Margin="0,0,0,14"/>

                            <TextBlock Text="Key:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Key}" 
                                     IsReadOnly="{Binding !IsEditMode}" 
                                     Watermark="Press &quot;Load projects&quot; button &amp; choose your project"
                                     Margin="0,0,0,14"/>

                            <TextBlock Text="Description:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Description}" IsReadOnly="{Binding !IsEditMode}"
                                     AcceptsReturn="True" Height="100" Margin="0,0,0,14"/>

                            <CheckBox Content="Active" IsChecked="{Binding IsActive}" IsEnabled="{Binding IsEditMode}" Margin="0,0,0,14"/>

                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,15,0,0">
                                <Button Content="Edit" Command="{Binding StartEditCommand}" IsVisible="{Binding !IsEditMode}"/>
                                <Button Content="Save" Command="{Binding SaveCommand}" IsVisible="{Binding IsEditMode}"/>
                                <Button Content="Cancel" Command="{Binding CancelEditCommand}" IsVisible="{Binding IsEditMode}" Classes="secondary"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>
        </TabItem>

        <TabItem Header="Tasks">
            <Grid RowDefinitions="Auto,*" ColumnDefinitions="2*,3*" Margin="10" Background="{StaticResource PrimaryBgBrush}">
                <!-- Tasks Filter/Search Bar -->
                <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                        Background="{StaticResource SecondaryBgBrush}"
                        CornerRadius="6"
                        Padding="20"
                        Margin="0,0,0,10"
                        BorderBrush="{StaticResource BorderDefaultBrush}"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Tasks" FontSize="18" FontWeight="Bold"
                                   Foreground="{StaticResource HeadingTextBrush}" Margin="0,0,0,15"/>

                        <Grid ColumnDefinitions="2*,*,*,Auto,Auto" ColumnSpacing="10" Margin="0,0,0,0">
                            <TextBox Grid.Column="0" Watermark="Search..."
                                     Text="{Binding TaskMasterViewModel.SearchText}"/>
                            <ComboBox Grid.Column="1" PlaceholderText="Status"
                                      ItemsSource="{Binding TaskMasterViewModel.AvailableStatuses}"
                                      SelectedItem="{Binding TaskMasterViewModel.SelectedStatus}"/>
                            <ComboBox Grid.Column="2" PlaceholderText="Priority"
                                      ItemsSource="{Binding TaskMasterViewModel.AvailablePriorities}"
                                      SelectedItem="{Binding TaskMasterViewModel.SelectedPriority}"/>
                            <Button Grid.Column="3" Content="Search" Command="{Binding TaskMasterViewModel.SearchCommand}"/>
                            <Button Grid.Column="4" Content="Clear" Command="{Binding TaskMasterViewModel.ClearFiltersCommand}" Classes="secondary"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Tasks Master Sidebar -->
                <Border Grid.Row="1" Grid.Column="0"
                        Background="{StaticResource SecondaryBgBrush}"
                        CornerRadius="6"
                        Padding="20"
                        Margin="0,0,10,0">
                    <Grid RowDefinitions="Auto,*">
                        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,15">
                            <Button Content="Load Tasks" Command="{Binding TaskMasterViewModel.LoadTasksCommand}"/>
                            <Button Content="Export to CSV" Command="{Binding TaskMasterViewModel.ExportToCsvCommand}"/>
                        </StackPanel>

                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding TaskMasterViewModel.Tasks}"
                                 SelectedItem="{Binding TaskMasterViewModel.SelectedTask}"
                                 Background="{StaticResource SecondaryBgBrush}"
                                 BorderThickness="0">
                            <ListBox.Styles>
                                <Style Selector="ListBoxItem">
                                    <Setter Property="Background" Value="{StaticResource CardBgBrush}"/>
                                    <Setter Property="Margin" Value="0,0,0,8"/>
                                    <Setter Property="Padding" Value="12"/>
                                    <Setter Property="CornerRadius" Value="4"/>
                                    <Setter Property="BorderBrush" Value="{StaticResource BorderDefaultBrush}"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Style>
                                <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="{StaticResource PrimaryButtonBgBrush}"/>
                                </Style>
                                <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                                    <Setter Property="Background" Value="{StaticResource PrimaryButtonBgBrush}"/>
                                </Style>
                            </ListBox.Styles>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Title}" FontWeight="Bold" Foreground="{StaticResource InputTextBrush}"/>
                                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                            <TextBlock Text="{Binding Status}" FontSize="11" Foreground="{StaticResource TabActiveBrush}"/>
                                            <TextBlock Text="{Binding Priority}" FontSize="11" Foreground="{StaticResource ValidationTextBrush}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <!-- Task Detail Panel -->
                <Border Grid.Row="1" Grid.Column="1"
                        Background="{StaticResource CardBgBrush}"
                        CornerRadius="6"
                        Padding="20"
                        BorderBrush="{StaticResource BorderDefaultBrush}"
                        BorderThickness="1">
                    <ScrollViewer>
                        <StackPanel DataContext="{Binding TaskMasterViewModel.TaskDetailViewModel}">
                            <TextBlock Text="Task Details" FontSize="18" FontWeight="Bold"
                                       Foreground="{StaticResource HeadingTextBrush}" Margin="0,0,0,15"/>

                            <TextBlock Text="{Binding TaskType, StringFormat='Type: {0}'}" FontWeight="Bold"
                                       Foreground="{StaticResource TabActiveBrush}" Margin="0,0,0,14"/>

                            <TextBlock Text="Title:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Title}" 
                                     IsReadOnly="{Binding !IsEditMode}" 
                                     Watermark="Press &quot;Load tasks&quot; button &amp; choose task"
                                     Margin="0,0,0,14"/>

                            <TextBlock Text="Description:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Description}" IsReadOnly="{Binding !IsEditMode}"
                                     AcceptsReturn="True" Height="100" Margin="0,0,0,14"/>

                            <TextBlock Text="Status:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding Status}" Foreground="{StaticResource InputTextBrush}" Margin="0,0,0,14"/>

                            <TextBlock Text="Priority:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding Priority}" Foreground="{StaticResource InputTextBrush}" Margin="0,0,0,14"/>

                            <TextBlock Text="Project Name:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding ProjectName}" 
                                     IsReadOnly="True" 
                                     Watermark="Press &quot;Load tasks&quot; button &amp; choose task"
                                     Margin="0,0,0,14"/>

                            <TextBlock Text="Project Key:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding ProjectKey}" 
                                     IsReadOnly="True" 
                                     Watermark="Press &quot;Load tasks&quot; button &amp; choose task"
                                     Margin="0,0,0,14"/>

                            <TextBlock Text="Assigned To:" Foreground="{StaticResource LabelTextBrush}" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding AssignedToName}" Foreground="{StaticResource InputTextBrush}" Margin="0,0,0,14"/>

                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,15,0,0">
                                <Button Content="Edit" Command="{Binding StartEditCommand}" IsVisible="{Binding !IsEditMode}"/>
                                <Button Content="Save" Command="{Binding SaveCommand}" IsVisible="{Binding IsEditMode}"/>
                                <Button Content="Cancel" Command="{Binding CancelEditCommand}" IsVisible="{Binding IsEditMode}" Classes="secondary"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>
        </TabItem>
    </TabControl>
</UserControl>
